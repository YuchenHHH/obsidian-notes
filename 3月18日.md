## SRAM 和 DRAM

**一、SRAM（静态随机存取存储器）**

• **英文全称**：Static Random Access Memory
• **原理和结构**：

• 每个存储单元由若干个晶体管（通常为6个）组成，形成一个触发器电路，能够稳定保存数据。
• 数据只要通电就一直保持，不需要周期性刷新（refresh），因此称之为“静态”。

• **特点**：
• **速度**：极快（典型访问时间1-10ns），比DRAM快。
• **容量**：相对较小，成本高，每比特占用面积大。
• **功耗**：静态功耗较低（空闲状态下功耗小），动态功耗取决于频率，但高频使用时功耗也不低。
• **用途**：用于CPU中的高速缓存（Cache），如L1、L2、L3缓存等。

---

**二、DRAM（动态随机存取存储器）**

• **英文全称**：Dynamic Random Access Memory
• **原理和结构**：
• 每个存储单元由1个晶体管和1个电容组成，电容内的电荷存储数据。
• 电容存储的电荷会逐渐泄漏，因此DRAM需要周期性刷新以维持数据（通常每64ms刷新一次），故称为“动态”存储器。
• **特点**：
• **速度**：相对较慢（典型访问时间为几十纳秒，20-100ns），远慢于SRAM。
• **容量**：密度高，单比特面积小，制造成本低，通常用于主内存。
• **功耗**：需要周期性刷新带来额外功耗；动态功耗随刷新和访问频率升高。
• **用途**：广泛用于主内存（计算机内存条），如DDR4、DDR5等。

## Cache
**平均访问时间（Average Access Time）** 用于衡量带有缓存（Cache）的内存系统的性能，计算公式为：

$\text{Average Access Time} = \text{Hit rate} \times \text{Hit Time} + (1 - \text{Hit rate}) \times \text{Miss Penalty}$

• **Hit rate（命中率）**：
• 访问缓存时，找到目标数据的概率。

• **Hit Time（命中时间）**：
• 从缓存成功取出数据的访问延迟。

• **Miss Penalty（缺失代价）**：
• 当缓存未命中时，需要从更慢的内存（如DRAM）获取数据的额外延迟。

### Direct Mapped Cache
**Direct Mapped Cache（直接映射缓存）** 是一种缓存结构，每个主存储地址只能映射到缓存（Cache）中的**唯一一个位置**。

也就是说：
• 内存中的任一地址，都有一个固定且唯一对应的缓存位置。
• 如果两个内存地址映射到同一位置，就会互相冲突（称为“冲突失效”）。

在Direct Mapped Cache中，主存地址一般分为三个部分：
```
| Tag (标签) | Cache Index (索引) | Block Offset (块内偏移) |
```
• **Tag（标签）**: 用于标识主存中不同的数据块。
• **Cache Index（索引）**: 决定了内存块将存放在Cache的哪个位置中。
• **Block Offset（块内偏移）**: 确定Cache中存放的数据块内的具体数据位置。

假设：
• 内存地址长度：$16$ bits
• Cache共有 $2^4$ = $16$ 行，因此索引长度为 $4$ 位
• 块大小为 $8$ 个字节（$2^3$ 字节），因此块偏移为 $3$ 位

```
| Tag（标签）(16 - 4 - 3 = 9 bits) | Index（索引）(4 bits) | Offset（偏移）(3 bits) |
例如地址：
Memory Address = 1011010110010110（二进制，16 bits）
划分为
Tag        Index  Offset
101101011 | 0010 | 110
```


### 写策略 Write Policy
Cache 的写策略（Write Policies）主要分为两个层次：

• **命中（Write Hit）**时的策略
• **缺失（Write Miss）**时的策略

---
**一、Cache 命中（Write Hit）策略：**
当 CPU 写数据时，如果对应数据已存在于 Cache 中，称为“写命中”。策略有两种：

**① Write-Through（写直达）**
• 数据同时写入 **Cache 和主存**。
• 主存与 Cache 保持一致。

**优点：**
• 主存与 Cache 始终保持同步，数据一致性高。
• 实现简单。 

**缺点：**
• 性能较低，主存速度慢，导致延迟高。
• 需要额外的写缓冲区（Write Buffer）提高性能。

---

**② Write-Back（写回法）**
• CPU 只写入 **Cache**，并设定标记位（Dirty bit），表示数据被修改但未更新到主存。
• 当缓存块被替换出 Cache 时，才将数据写回主存。

**优点：**
• 写入速度快，降低访存延迟。
• 减少主存访问次数。

**缺点：**
• 需要 Dirty bit 标记被修改的数据。
• Cache 数据与主存数据暂时可能不同步。

---
**二、Cache 缺失（Write Miss）策略：**
当 CPU 写数据时，如果数据不在 Cache 中，称为“写缺失”，此时策略有两种：

**① Write Allocate（写分配）**
• 出现写缺失后，将对应的数据块 **先加载到Cache** 中，再执行写操作。
• 通常搭配 Write-Back 使用。

**适合场景**：
• 适合频繁修改的数据，数据很可能很快再次被访问。

---

**② No-Write Allocate（不写分配）**
• 出现写缺失时，不加载到 Cache，**直接写入主存**。
• 通常搭配 Write-Through 使用。

**适合场景**：
• 不太可能重复访问的数据，避免频繁置换。

---
**三、典型搭配策略组合：**

实际应用中，常见的两种策略组合：

|**组合策略**|**命中策略**|**缺失策略**|**特点**|
|---|---|---|---|
|A|Write-Back|Write Allocate|高效、性能高，常用于CPU高速缓存|
|B|Write-Through|No-Write Allocate|数据一致性强，常用于磁盘缓存|

---

**四、策略选择原则：**
• **高速缓存（如CPU Cache）**：
• 常用 **Write-Back + Write Allocate**，降低内存访问次数，提高性能。

• **磁盘缓存或I/O缓存**：
• 常用 **Write-Through + No-Write Allocate**，保证数据安全性。

---

**五、小结：**
Cache写策略主要由以下两种组合而成：

|**Cache写策略**|**描述**|
|---|---|
|命中（Hit）|Write-Through（写直达）、Write-Back（写回）|
|缺失（Miss）|Write Allocate（写分配）、No-Write Allocate（不写分配）|

实际使用时根据具体需求选择组合策略。

## 组相连算法

## 替换算法

<<<<<<< HEAD
=======

# 3月19日
>>>>>>> origin/main
